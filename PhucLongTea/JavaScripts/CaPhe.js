var CaPhe = [
    { name: 'Cà Phê Cherry', price: 125, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/f384c4ba334006-cherrykbo500g.jpg', count: 1 },
    { name: 'Cà Phê Cherry', price: 54, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/f384c4ba334006-cherrykbo500g.jpg', count: 1 },
    { name: 'Cà Phê Robusta - Culi', price: 130, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/9285f2a1e555ac-cphrobustaculiphclong500g.png', count: 1 },
    { name: 'Cà Phê Robusta - Culi', price: 54, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/9285f2a1e555ac-cphrobustaculiphclong500g.png', count: 1 },
    { name: 'Cà Phê Royal Không Bơ', price: 70, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/955702bca44693-cphroyalkhngbphclong.png', count: 1 },
    { name: 'Cà Phê Royal Không Bơ', price: 170, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/955702bca44693-cphroyalkhngbphclong.png', count: 1 },
    { name: 'Cà Phê Royal Có Bơ', price: 170, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/bc0b1e3327a80e-caferoyalcobophuclong.jpg', count: 1 },
    { name: 'Cà Phê King Không Bơ', price: 76, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/1cd3270b54457b-img_2478.png', count: 1 },
    { name: 'Cà Phê Royal Có Bơ', price: 70, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/bc0b1e3327a80e-caferoyalcobophuclong.jpg', count: 1 },
    { name: 'Cà Phê King Không Bơ', price: 185, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/1cd3270b54457b-img_2478.png', count: 1 },
    { name: 'Cà Phê Robusta Không Bơ', price: 76, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/57ff5023306f67-caferobustakhngbphclong.png', count: 1 },
    { name: 'Cà Phê King Có Bơ', price: 76, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/3d9ded48253009-cphkingcbphclong.png', count: 1 },
    { name: 'Cà Phê Robusta Không Bơ', price: 130, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/57ff5023306f67-caferobustakhngbphclong.png', count: 1 },
    { name: 'Cà Phê King Có Bơ', price: 185, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/3d9ded48253009-cphkingcbphclong.png', count: 1 },
    { name: 'Cà Phê Moca Không Bơ', price: 86, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/9bb5775e71550e-cphmokakhngbphclong.png', count: 1 },
    { name: 'Cà Phê Moca Không Bơ', price: 210, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/9bb5775e71550e-cphmokakhngbphclong.png', count: 1 },
    { name: 'Cà Phê Robusta Có Bơ', price: 54, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/b7a9b96c4ef00c-cphrobustacbphclong.png', count: 1 },
    { name: 'Cà Phê Robusta Có Bơ', price: 130, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/b7a9b96c4ef00c-cphrobustacbphclong.png', count: 1 },
    { name: 'Cà Phê Vanilla', price: 74, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/d5cb1aa5e36899-cphvanillaphclong.png', count: 1 },
    { name: 'Cà Phê Moka Blend Có Bơ', price: 140, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/f48d028b3b5f13-mokablendfr_img_1093.png', count: 1 },
    { name: 'Cà Phê Moka Blend Có Bơ', price: 58, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/f48d028b3b5f13-mokablendfr_img_1093.png', count: 1 },
    { name: 'Cà Phê Rich', price: 105, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/4351fbbb455aba-cphrichphclong.png', count: 1 },
    { name: 'Cà Phê Culi', price: 52, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/eb69890f81685b-cphculiphclong.png', count: 1 },
    { name: 'Cà Phê Culi', price: 125, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/eb69890f81685b-cphculiphclong.png', count: 1 },
    { name: 'Cà Phê Smooth', price: 97, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/79ab8ed71f5b43-cphsmoothphclong.png', count: 1 },
    { name: 'Cà Phê Caramel', price: 74, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/a91500b3ed4a86-cphmicaramel01.png', count: 1 },
    { name: 'Cà Phê Capuccino', price: 74, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/924c282a97b1d8-cphcapuccinophclong.png', count: 1 },
    { name: 'Cà Phê Chocolate', price: 74, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/b237cecb774091-cphchocolatephclong.png', count: 1 },
    { name: 'Cà Phê Moka + Fin Nhôm', price: 116, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/63067346c5f6c5-cphmokafinnhm.png', count: 1 },
    { name: 'Cà Phê Moka Blend + Fin Nhôm', price: 116, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/c7820185f3dbd0-cphmokablendfinnhm.png', count: 1 },
]

function DomID(id) {
    return document.getElementById(id);
}
var arrBuy = [];
var countNumber = 12;
render(CaPhe);
function render(value) {
    var showSanPham = [];
    DomID('SanPham').innerHTML = "";
    for (let v of value) {
        let sanpham = '<div class="product"> <div class="product-img"><img src="' + v.img + '" alt=""></div>' +
            '<div class="product-title">' + v.name + '</div><div class="product-desc">' + v.desc + '</div><div class="product-price">' + v.price + '.000 đ</div>' +
            '<div class="product-button"><input type="button" value="Đặt hàng" class="button-buy"> </div></div>';
        showSanPham.push(sanpham);
    }
    var renderHTML = showSanPham.join('');
    DomID('SanPham').innerHTML = renderHTML;
    dathang(value);
    taoSlide(value);
}
arrNull = [];
for (let v of CaPhe) {
    arrNull.push(v);
}
function TangDan(arr) {
    for (let i = 0; i < arr.length; i++) {
        for (var j = i + 1; j < arr.length; j++) {
            if (arr[i].price > arr[j].price) {
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
        }
    }
}
function GiamDan(arr) {
    for (let i = 0; i < arr.length; i++) {
        for (var j = i + 1; j < arr.length; j++) {
            if (arr[i].price < arr[j].price) {
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
        }
    }
}
DomID('sapxep').addEventListener('change', () => {
    var selectedSanPham = DomID('sapxep').value;
    if (selectedSanPham == 'tangDan') {
        TangDan(CaPhe);
        render(CaPhe);
    }
    else if (selectedSanPham == 'giamDan') {
        GiamDan(CaPhe);
        render(CaPhe);
    }
    else {
        render(arrNull);
    }
});

DomID('button-timKiem').addEventListener('click', () => {
    var txtSearch = DomID('timKiem').value.toUpperCase();
    var arrTimKiem = [];
    for (let i = 0; i < CaPhe.length; i++) {
        if (CaPhe[i].name.toUpperCase().indexOf(txtSearch) !== -1) {
            arrTimKiem.push(CaPhe[i]);
        }
    }
    render(arrTimKiem);
})
DomID('timKiem').addEventListener('keyup', () => {
    if (DomID('timKiem').value.length === 0) {
        render(CaPhe);
    }
})

var tongTien = 0;
DomID('TotalMoney').innerHTML = tongTien + 'đ';
if(localStorage.getItem('sanpham') !== null) {
    arrBuy = JSON.parse(localStorage.getItem('sanpham'));
    renderProductBuy(arrBuy);
    
    countCard = arrBuy.reduce((sum, e) => sum += e.count, 0);
    DomID('countStore').innerHTML = countCard;
    
    tongTien= arrBuy.reduce((sum, e)=>sum+=e.count*e.price,0);
    if (tongTien === 0) {
        DomID('TotalMoney').innerHTML = tongTien + 'đ';
    }
    else DomID('TotalMoney').innerHTML = tongTien + '.000đ';
}
function dathang(value) {
    for (let i = 0; i < value.length; i++) {
        var button = document.getElementsByClassName('button-buy');
        button[i].addEventListener('click', () => {
            tongTien += value[i].price;
            DomID('TotalMoney').innerHTML = tongTien + '.000đ';
            if (arrBuy.length > 0) {
                let flag = false;
                arrBuy.map(v => {
                    if (v.name === value[i].name && v.desc === value[i].desc) {
                        flag = true;
                        return v.count++;
                    }
                });
                if (flag === false) {
                    arrBuy.push(value[i]);
                }
            } else {
                arrBuy.push(value[i]);
            }
            renderProductBuy(arrBuy);
        })
    }
}
function xoahang(n) {
    tongTien = tongTien - arrBuy[n].price * arrBuy[n].count;
    if (tongTien === 0) {
        DomID('TotalMoney').innerHTML = tongTien + 'đ';
    }
    else DomID('TotalMoney').innerHTML = tongTien + '.000đ';
    arrBuy[n].count = 1;
    arrBuy.splice(n, 1);
    renderProductBuy(arrBuy);
}
function renderProductBuy(value) {
    localStorage.setItem('sanpham',JSON.stringify(value));
    var count = 0;
    var sanpham = "";
    for (let i = 0; i < value.length; i++) {
        sanpham += '<li class="show-SanPham"><img src="' + value[i].img +
            '"alt=><div class="buy-title"><h4>' + value[i].name + ' (' + value[i].desc +
            ')</h4></div><input type="text" value="' + value[i].count +
            '" class="qual-buy" disabled><div class="buy-price"><p>x ' + value[i].price +
            '.000đ</p></div><a class="delete" onclick="xoahang(' + i + ')">x</a>"</li>';
        count += Number(value[i].count);
    }
    DomID('countStore').innerHTML = count;
    DomID('showSanPham').innerHTML = sanpham;
}
DomID('buyProduct').addEventListener('click',()=>{
    alert('Bạn đã mua thành công');
    arrBuy.map(v => {
        return v.count=1;
        })

    arrBuy.splice(0,arrBuy.length);
    renderProductBuy(arrBuy);
    tongTien = 0;
    DomID('TotalMoney').innerHTML = tongTien + 'đ';    
})

function taoSlide(value) {
    var numberSlide = parseInt(value.length / countNumber);
    if (numberSlide > 0 && value.length != 12) {
        DomID('Slide').innerHTML += '<i class="fas fa-arrow-circle-left" onclick="Pre(-1)"></i>'
        for (let i = 0; i <= numberSlide; i++) {
            DomID('Slide').innerHTML += '<span class="dot" onclick="PageImg(' + Number(i + 1) + ')">' + Number(i + 1) + '</span>'
        }
        DomID('Slide').innerHTML += '<i class="fas fa-arrow-circle-right" onclick="Next(1)"></i>'
    }
}

var slideIndex = 0;
var z = document.getElementsByClassName("dot");
Sliding(slideIndex);


function Sliding(n) {
    var x = document.getElementsByClassName("product");
    for (let i = 0; i < z.length; i++) {
        z[i].style.backgroundColor = "#ffff";
        z[i].style.color = "green";
    }
    for (let i = 0; i < x.length; i++) {
        x[i].style.display = "none";
    }
    if (n >= z.length) {
        slideIndex = 0;
        n = 0;
    }
    var start = n * countNumber;
    var end = (n + 1) * countNumber;
    console.log(start);
    for (let i = start; i < end; i++) {
        if (x.length === i) {
            break;
        }
        else x[i].style.display = "block";
    }

    z[slideIndex].style.backgroundColor = "green";
    z[slideIndex].style.color = "white";
}
function PageImg(n) {
    Sliding(slideIndex = n - 1);
}
function Next(n) {
    Sliding(slideIndex += n);
}
function Pre(n) {
    slideIndex += n;
    if (slideIndex + 1 == 0) {
        slideIndex = z.length - 1;
        Sliding(slideIndex);
    }
    else {
        Sliding(slideIndex);
    }
}