var Tra = [
    { name: 'trà sen túi lọc', price: 13, desc: '2g x 8 gói', img: 'https://phuclong.com.vn/uploads/dish/2b93a26ac51710-trasentuilocphuclonghop8goi.jpg', count: 1 },
    { name: 'trà lài túi lọc', price: 12, desc: '2g x 8 gói', img: 'https://phuclong.com.vn/uploads/dish/409dfd65de47e1-tralaituilocphuclonghop8goi.jpg', count: 1 },
    { name: 'trà xanh vạn lý hương', price: 20, desc: '80g', img: 'https://phuclong.com.vn/uploads/dish/5bd6d66932dfc1-trxanhvnlhngphclong.png', count: 1 },
    { name: 'Trà Hoa Hồng Túi Lọc', price: 34, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/925ad83267c519-trhoahongtilcphclong.png', count: 1 },
    { name: 'trà vãi túi lọc', price: 37, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/925ad83267c519-trhoahongtilcphclong.png', count: 1 },
    { name: 'trà xanh thái nguyên', price: 29, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/1d88363528e16b-txtn500g.jpg', count: 1 },
    { name: 'trà sen túi lọc', price: 35, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/1fdc7a610e0c86-trsentilcphclong.png', count: 1 },
    { name: 'trà xanh 15', price: 145, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/b651a8b758f713-traxanh15phuclong.jpg', count: 1 },
    { name: 'trà xanh thái nguyên', price: 266, desc: '1kg', img: 'https://phuclong.com.vn/uploads/dish/c578d3fe9de6c8-cphdaxayvthch.jpg', count: 1 },
    { name: 'trà sen túi tam giác', price: 76, desc: '3g x 10 gói', img: 'https://phuclong.com.vn/uploads/dish/aa48790b50dc65-trsentitamgicphclong.png', count: 1 },
    { name: 'hồng trà túi lọc', price: 35, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/7ea152f86c543b-hngtrtilcphclong.png', count: 1 },
    { name: 'trà xanh 15', price: 60, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/e34e10d6d175f0-traxanh15phuclong.jpg', count: 1 },
    { name: 'trà ô long 80', price: 151, desc: '150g', img: 'https://phuclong.com.vn/uploads/dish/da8b029cb3691c-tpolo018tragoiolong.png', count: 1 },
    { name: 'trà xanh thái nguyên', price: 127, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/124371b7a18869-txtn500g.jpg', count: 1 },
    { name: 'trà lài túi tam giác', price: 76, desc: '3g x 10 gói', img: 'https://phuclong.com.vn/uploads/dish/5b668796fecc3b-trlititamgicphclong.png', count: 1 },
    { name: 'trà xanh túi lọc', price: 29, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/4da70ef7a21ed3-trxanhtilcphclong.png', count: 1 },
    { name: 'trà lài đặc biệt', price: 79, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/72ba38655c9817-tralaidacbietphuclong.jpg', count: 1 },
    { name: 'trà xanh 15', price: 30, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/2c4d8af85eb376-traxanh15phuclong.jpg', count: 1 },
    { name: 'trà xanh thái nguyên', price: 52, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/a697a97718dfb9-txtn200g.jpg', count: 1 },
    { name: 'trà xanh đặc biệt (mẫu lá tre)', price: 229, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/b71094067c35ef-trxanhcbitmultre.png', count: 1 },
    { name: 'trà lài hộp giấy', price: 110, desc: '250g', img: 'https://phuclong.com.vn/uploads/dish/b4ece40277dc79-trlihpgiyphclong.png', count: 1 },
    { name: 'trà xanh túi tam giác', price: 76, desc: '3g x 10 gói', img: 'https://phuclong.com.vn/uploads/dish/589293b7f53540-trxanhtitamgicphclong.png', count: 1 },
    { name: 'trà ô long túi lọc', price: 36, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/0c65edda13706b-trlongtilcphclong.png', count: 1 },
    { name: 'trà sen đặc biệt', price: 385, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/495fccb5d1f59b-trasendacbietphuclong.jpg', count: 1 },
    { name: 'trà xanh tân cương đặc biệt', price: 250, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/3b2308a50c5f0f-traxanhtancuongdacbietphuclong.jpg', count: 1 },
    { name: 'trà lài 15', price: 240, desc: '500g', img: 'https://phuclong.com.vn/uploads/dish/ac42d17a7da7e5-tralai15phuclong.jpg', count: 1 },
    { name: 'trà đen', price: 27, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/affeae10bb3a06-traden.png', count: 1 },
    { name: 'trà xanh thái nguyên phúc long', price: 34, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/1bb863604bba2a-trxanhthinguynphclong.png', count: 1 },
    { name: 'trà lài lon giấy cao cấp', price: 70, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/4e4430e181d510-trlilongiycaocpphclong.png', count: 1 },
    { name: 'trà sen hộp giấy', price: 72, desc: '150g', img: 'https://phuclong.com.vn/uploads/dish/56676ff02bcac2-trsenhpgiyphclong.png', count: 1 },
    { name: 'trà lài vạn lý hương', price: 21, desc: '80g', img: 'https://phuclong.com.vn/uploads/dish/1236194f37e045-trlivnlhngphclong.png', count: 1 },
    { name: 'trà ô long túi tam giác', price: 87, desc: '3g x 10 gói', img: 'https://phuclong.com.vn/uploads/dish/cafe33c3bb40d5-trlongtitamgicphclong.png', count: 1 },
    { name: 'trà đào túi lọc', price: 37, desc: '2g x 25 gói', img: 'https://phuclong.com.vn/uploads/dish/9224ead04db9af-trotilcphclong.png', count: 1 },
    { name: 'trà nõn tôm ủ lạnh túi tam giác', price: 129, desc: '2g x 12 túi', img: 'https://phuclong.com.vn/uploads/dish/1f9912a11f07df-traulanhnontomphuclong.png', count: 1 },
    { name: 'trà lài ủ lạnh túi tam giác', price: 109, desc: '2g x 12 túi', img: 'https://phuclong.com.vn/uploads/dish/73ce7137231a5f-tuizipjasmine.png', count: 1 },
    { name: 'trà sen đặc biệt', price: 156, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/4047cc1c864d7b-tralaidacbietphuclong.jpg', count: 1 },
    { name: 'trà xanh tân cương đặc biệt', price: 102, desc: '200g', img: 'https://phuclong.com.vn/uploads/dish/d171954f6fb40a-traxanhtancuongdacbietphuclong.jpg', count: 1 },
    { name: 'trà sen lon giấy cao cấp', price: 70, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/522d6d98733774-trsenlongiycaocpphclong.png', count: 1 },
    { name: 'trà lài vạn lý hương (lon)', price: 39, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/84615da23e6ddc-vlhlon.png', count: 1 },
    { name: 'hộp giấy vuông 5 loại trà', price: 540, desc: '24g x 10 hộp', img: 'https://phuclong.com.vn/uploads/dish/faead9badf4460-tpgiv002hopgiayvuong5loaitra.png', count: 1 },
    { name: 'trà ô long hộp oval', price: 135, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/077de7d121bfc1-trlonghpovalphclong.png', count: 1 },
    { name: 'trà xanh lon giấy cao cấp', price: 50, desc: '100g', img: 'https://phuclong.com.vn/uploads/dish/ad72634e34caba-trxanhlongiycaocpphclong.png', count: 1 },
];
function DomID(id) {
    return document.getElementById(id);
}
var arrBuy = [];
var countNumber = 12;
render(Tra);
function render(value) {
    var showSanPham = [];
    DomID('SanPham').innerHTML = "";
    for (let v of value) {
        let sanpham = '<div class="product"> <div class="product-img"><img src="' + v.img + '" alt=""></div>' +
            '<div class="product-title">' + v.name + '</div><div class="product-desc">' + v.desc + '</div><div class="product-price">' + v.price + '.000 đ</div>' +
            '<div class="product-button"><input type="button" value="Đặt hàng" class="button-buy"> </div></div>';
        showSanPham.push(sanpham);
    }
    var renderHTML = showSanPham.join('');
    DomID('SanPham').innerHTML = renderHTML;
    dathang(value);
    taoSlide(value);
}
arrNull = [];
for (let v of Tra) {
    arrNull.push(v);
}
function TangDan(arr) {
    for (let i = 0; i < arr.length; i++) {
        for (var j = i + 1; j < arr.length; j++) {
            if (arr[i].price > arr[j].price) {
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
        }
    }
}
function GiamDan(arr) {
    for (let i = 0; i < arr.length; i++) {
        for (var j = i + 1; j < arr.length; j++) {
            if (arr[i].price < arr[j].price) {
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
        }
    }
}
DomID('sapxep').addEventListener('change', () => {
    var selectedSanPham = DomID('sapxep').value;
    if (selectedSanPham == 'tangDan') {
        TangDan(Tra);
        render(Tra);
    }
    else if (selectedSanPham == 'giamDan') {
        GiamDan(Tra);
        render(Tra);
    }
    else {
        render(arrNull);
    }
});

DomID('button-timKiem').addEventListener('click', () => {
    var txtSearch = DomID('timKiem').value.toUpperCase();
    var arrTimKiem = [];
    for (let i = 0; i < Tra.length; i++) {
        if (Tra[i].name.toUpperCase().indexOf(txtSearch) !== -1) {
            arrTimKiem.push(Tra[i]);
        }
    }
    render(arrTimKiem);
})
DomID('timKiem').addEventListener('keyup', () => {
    if (DomID('timKiem').value.length === 0) {
        render(Tra);
    }
})
var tongTien = 0;
DomID('TotalMoney').innerHTML = tongTien + 'đ';
if(localStorage.getItem('sanpham') !== null) {
    arrBuy = JSON.parse(localStorage.getItem('sanpham'));
    renderProductBuy(arrBuy);
    
    countCard = arrBuy.reduce((sum, e) => sum += e.count, 0);
    DomID('countStore').innerHTML = countCard;
    
    tongTien= arrBuy.reduce((sum, e)=>sum+=e.count*e.price,0);
    if (tongTien === 0) {
        DomID('TotalMoney').innerHTML = tongTien + 'đ';
    }
    else DomID('TotalMoney').innerHTML = tongTien + '.000đ';
}


function dathang(value) {
    for (let i = 0; i < value.length; i++) {
        var button = document.getElementsByClassName('button-buy');
        button[i].addEventListener('click', () => {
            tongTien =parseInt(tongTien)+ value[i].price;
            DomID('TotalMoney').innerHTML=tongTien+'.000đ';
            if (arrBuy.length > 0) {
                let flag = false;
                arrBuy.map(v => {
                    if (v.name === value[i].name && v.desc === value[i].desc) {
                        flag = true;
                        return v.count++;
                    }
                });
                if (flag === false) {
                    arrBuy.push(value[i]);
                }
            } else {
                arrBuy.push(value[i]);
            }
            renderProductBuy(arrBuy);
        })
    }
}
function xoahang(n) {
    tongTien = tongTien - arrBuy[n].price * arrBuy[n].count;
    if (tongTien === 0) {
        DomID('TotalMoney').innerHTML = tongTien + 'đ';
    }
    else DomID('TotalMoney').innerHTML = tongTien + '.000đ';
    arrBuy[n].count = 1;
    arrBuy.splice(n, 1);
    renderProductBuy(arrBuy);
}
function renderProductBuy(value) {
    localStorage.setItem('sanpham',JSON.stringify(value));
    var count = 0;
    var sanpham = "";
    for (let i = 0; i < value.length; i++) {
        sanpham += '<li class="show-SanPham"><img src="' + value[i].img +
            '"alt=><div class="buy-title"><h4>' + value[i].name + ' (' + value[i].desc +
            ')</h4></div><input type="text" value="' + value[i].count +
            '" class="qual-buy" disabled><div class="buy-price"><p>x ' + value[i].price +
            '.000đ</p></div><a class="delete" onclick="xoahang(' + i + ')">x</a>"</li>';
        count += Number(value[i].count);
    }
    DomID('countStore').innerHTML = count;
    DomID('showSanPham').innerHTML = sanpham;
}

DomID('buyProduct').addEventListener('click',()=>{
    alert('Bạn đã mua thành công');
    arrBuy.map(v => {
        return v.count=1;
        })
    arrBuy.splice(0,arrBuy.length);
    renderProductBuy(arrBuy);
    tongTien = 0;
    DomID('TotalMoney').innerHTML = tongTien + 'đ';    

})

function taoSlide(value) {
    var numberSlide = parseInt(value.length / countNumber);
    if (numberSlide > 0 && value.length != 12) {
        DomID('Slide').innerHTML += '<i class="fas fa-arrow-circle-left" onclick="Pre(-1)"></i>'
        for (let i = 0; i <= numberSlide; i++) {
            DomID('Slide').innerHTML += '<span class="dot" onclick="PageImg(' + Number(i + 1) + ')">' + Number(i + 1) + '</span>'
        }
        DomID('Slide').innerHTML += '<i class="fas fa-arrow-circle-right" onclick="Next(1)"></i>'
    }
}

var slideIndex = 0;
var z = document.getElementsByClassName("dot");
Sliding(slideIndex);


function Sliding(n) {
    var x = document.getElementsByClassName("product");
    for (let i = 0; i < z.length; i++) {
        z[i].style.backgroundColor = "#ffff";
        z[i].style.color = "green";
    }
    for (let i = 0; i < x.length; i++) {
        x[i].style.display = "none";
    }
    if (n >= z.length) {
        slideIndex = 0;
        n = 0;
    }
    var start = n * countNumber;
    var end = (n + 1) * countNumber;
    console.log(start);
    for (let i = start; i < end; i++) {
        if (x.length === i) {
            break;
        }
        else x[i].style.display = "block";
    }

    z[slideIndex].style.backgroundColor = "green";
    z[slideIndex].style.color = "white";
}
function PageImg(n) {
    Sliding(slideIndex = n - 1);
}
function Next(n) {
    Sliding(slideIndex += n);
}
function Pre(n) {
    slideIndex += n;
    if (slideIndex + 1 == 0) {
        slideIndex = z.length - 1;
        Sliding(slideIndex);
    }
    else {
        Sliding(slideIndex);
    }
}
